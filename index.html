    <script>
        // 1. Register Service Worker (Standard PWA stuff)
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js')
            .then(() => console.log("Service Worker Registered"));
        }

        // 2. The Real Data Logic
        const API_URL = "https://api.open511.gov.bc.ca/events?status=ACTIVE";

        async function showStatus(type) {
            const display = document.getElementById('output');
            display.innerHTML = '<p style="text-align:center; margin-top:20px;">Connecting to DriveBC...</p>';

            try {
                // Fetch live data from BC Government
                const response = await fetch(API_URL);
                const data = await response.json();
                
                // Filter the results based on which button you clicked
                let events = [];
                let title = "";

                if (type === 'Closures') {
                    title = "â›” Active Road Closures";
                    // Filter for events that are actually CLOSED
                    events = data.events.filter(e => 
                        e.headline.includes("CLOSED") || 
                        e.description.toUpperCase().includes("CLOSED")
                    );
                } 
                else if (type === 'Advisories') {
                    title = "âš ï¸ Travel Advisories";
                    // Filter for general incidents that aren't full closures
                    events = data.events.filter(e => 
                        e.event_type === "INCIDENT" && 
                        !e.headline.includes("CLOSED")
                    );
                } 
                else if (type === 'Chain Ups') {
                    title = "â›“ï¸ Chain Up Areas";
                    // Search for "Chain" in the description
                    events = data.events.filter(e => 
                        e.description.toUpperCase().includes("CHAIN") ||
                        e.description.toUpperCase().includes("WINTER")
                    );
                }
                else if (type === 'Cameras') {
                    // Webcams use a different system, so we'll keep this simple for now
                    display.innerHTML = '<div class="status-card">ðŸ“· <strong>Webcam Feeds</strong><br>Access to live webcam images requires a different data connection. <br><br>Coming in Version 2.0!</div>';
                    return;
                }

                // 3. Build the List to Display
                if (events.length === 0) {
                    display.innerHTML = `<h3>${title}</h3><div class="status-card" style="border-left: 5px solid green;"><strong>No active events found.</strong><br>Drive safe!</div>`;
                } else {
                    let htmlContent = `<h3>${title}</h3><p style="font-size:12px; color:#666;">Found ${events.length} reports</p>`;
                    
                    // Take the first 10 events so the phone doesn't freeze
                    events.slice(0, 10).forEach(item => {
                        // Clean up the road name
                        let roadName = item.roads[0] ? item.roads[0].name : "Highway";
                        let description = item.description;

                        htmlContent += `
                        <div class="status-card" style="border-left-color: ${getColor(type)}">
                            <strong>${roadName}</strong><br>
                            <span style="font-size:13px; color:#444;">${description}</span>
                            <br><span style="font-size:11px; color:#888;">Updated: ${item.updated.substring(0, 10)}</span>
                        </div>`;
                    });
                    display.innerHTML = htmlContent;
                }

            } catch (error) {
                console.error(error);
                display.innerHTML = `<div class="status-card" style="border-left: 5px solid red;"><strong>Connection Error</strong><br>Could not reach DriveBC. Check your internet.</div>`;
            }
        }

        function getColor(type) {
            if(type == 'Closures') return '#d32f2f'; // Red
            if(type == 'Advisories') return '#f57c00'; // Orange
            if(type == 'Chain Ups') return '#1976d2'; // Blue
            return '#555';
        }
    </script>
